<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.47 in css mode. -->
<html>
  <head>
    <title>runner.cljs</title>
    <style type="text/css">
    <!--
      body {
        color: #DCDCCC;
        background-color: #3F3F3F;
      }
      .builtin {
        /* font-lock-builtin-face */
        color: #DCDCCC;
        font-weight: bold;
      }
      .constant {
        /* font-lock-constant-face */
        color: #BFEBBF;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #93E0E3;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #F0DFAF;
        font-weight: bold;
      }
      .preprocessor {
        /* font-lock-preprocessor-face */
        color: #94BFF3;
        font-weight: bold;
      }
      .string {
        /* font-lock-string-face */
        color: #CC9393;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
(<span class="keyword">ns</span> runner
  (<span class="constant">:require</span>
   [clojure.browser.repl]
   [om.core <span class="constant">:as</span> om <span class="constant">:include-macros</span> true]
   [sablono.core <span class="constant">:as</span> html <span class="constant">:refer</span> [html] <span class="constant">:include-macros</span> true]
   [processing.core <span class="constant">:as</span> canvas <span class="constant">:include-macros</span> true]
   [cljs.core.match]
   [dommy.core <span class="constant">:as</span> dom])
  (<span class="constant">:require-macros</span>
   [dommy.macros <span class="constant">:refer</span> [node sel1]]
   [runner <span class="constant">:as</span> runner]
   [cljs.core.match.macros <span class="constant">:refer</span> [match]]))

(<span class="keyword">defn</span> <span class="function-name">reset</span> []
  (js/location.reload true))

(<span class="keyword">defn</span> <span class="function-name">bezier</span>
  [processing state]
  (<span class="builtin">reify</span>
    canvas/<span class="preprocessor">ICanvas</span>
    (setup [_]
      (canvas/size 640 360)
      (canvas/stroke 255)
      (canvas/no-fill))
    (draw [_ _ {<span class="constant">:keys</span> [x] <span class="constant">:as</span> mouse} {<span class="constant">:keys</span> [key key-code] <span class="constant">:as</span> kb}]
      (canvas/background 0)
      (<span class="keyword">loop</span> [i 0]
        (<span class="keyword">when</span> (<span class="builtin">&lt;</span> i 200)
          (canvas/bezier (<span class="builtin">-</span> x (<span class="builtin">/</span> i 2.0)) (<span class="builtin">+</span> 40 i) 410 20 440 300
                         (<span class="builtin">-</span> 240 (<span class="builtin">/</span> i 16.0)) (<span class="builtin">+</span> 300 (<span class="builtin">/</span> i 8.0)))
          (<span class="keyword">recur</span> (<span class="builtin">+</span> i 20)))))))

(<span class="keyword">defn</span> <span class="function-name">draw-pie-chart</span>
  [diameter {<span class="constant">:keys</span> [angles width height] <span class="constant">:as</span> state}]
  (<span class="keyword">loop</span> [i 0 last-angle 0]
    (<span class="keyword">when</span> (<span class="builtin">&lt;</span> i (<span class="builtin">count</span> angles))
      (canvas/fill (canvas/map i 0 (<span class="builtin">count</span> angles) 0 255))
      (canvas/arc (<span class="builtin">/</span> width 2) (<span class="builtin">/</span> height 2) diameter diameter last-angle
                  (<span class="builtin">+</span> last-angle (canvas/radians (<span class="builtin">nth</span> angles i))))
      (<span class="keyword">recur</span> (<span class="builtin">inc</span> i) (<span class="builtin">+</span> last-angle (canvas/radians (<span class="builtin">nth</span> angles i)))))))

(<span class="keyword">defn</span> <span class="function-name">pie-chart</span>
  [processing state]
  (<span class="builtin">reify</span>
    canvas/<span class="preprocessor">ICanvas</span>
    (setup [_]
      (canvas/size 640 360)
      (canvas/no-stroke)
      {<span class="constant">:angles</span> [30 10 45 35 60 38 75 67]})
    (draw [_ state _ _]
      (canvas/background 100)
      (draw-pie-chart 300 state))))

(<span class="keyword">defn</span> <span class="constant">^:export</span> <span class="function-name">-main</span> []
  (<span class="keyword">let</span> [container (<span class="builtin">node</span> [<span class="constant">:div.container</span>])]
    (dom/append! js/document.body container)
    (om/<span class="builtin">root</span> {<span class="constant">:examples</span> [{<span class="constant">:title</span> <span class="string">"pie chart"</span>
                          <span class="constant">:f</span> pie-chart
                          <span class="constant">:animate</span> false
                          <span class="constant">:code</span> (runner/htmlize draw-pie-chart pie-chart)}
                         {<span class="constant">:title</span> <span class="string">"bezier"</span>
                          <span class="constant">:f</span> bezier
                          <span class="constant">:code</span> (runner/htmlize bezier)}]
              <span class="constant">:active</span> nil}
      (<span class="keyword">fn</span> [data owner]
        (<span class="builtin">reify</span>
          om/<span class="preprocessor">IRenderState</span>
          (render-state [_ _]
            (html [<span class="constant">:div</span>
                   [<span class="constant">:h1</span> <span class="string">"processing.cljs"</span>]
                   [<span class="constant">:p</span> <span class="string">"thin ClojureScript veneer over "</span>
                    [<span class="constant">:a</span> {<span class="constant">:href</span> <span class="string">"http://www.processingjs.org"</span>}
                     <span class="string">"processing.js"</span>]]
                   [<span class="constant">:div#content</span>
                    [<span class="constant">:h3</span> <span class="string">"usage "</span>
                     [<span class="constant">:small</span> <span class="string">"examples based on: "</span>
                      [<span class="constant">:a</span> {<span class="constant">:href</span> <span class="string">"http://processing.org/examples"</span>}
                       <span class="string">"http://processing.org/examples"</span>]]]
                    
                    [<span class="constant">:div.row</span>
                     [<span class="constant">:div.col-sm-2</span>
                      [<span class="constant">:ul.list-unstyled</span>
                       (<span class="keyword">for</span> [{<span class="constant">:keys</span> [title f] <span class="constant">:as</span> example} (<span class="constant">:examples</span> data)]
                         [<span class="constant">:li</span>
                          [<span class="constant">:a</span> {<span class="constant">:style</span> {<span class="constant">:cursor</span> <span class="string">"pointer"</span>}
                               <span class="constant">:on-click</span>
                               (<span class="keyword">fn</span> [e]
                                 (om/update! data assoc <span class="constant">:active</span> example))}
                           [<span class="constant">:h5</span> title]]])]]
                     [<span class="constant">:div.col-sm-10</span>
                      (<span class="keyword">if</span> (<span class="constant">:active</span> data)
                        (om/build canvas/canvas data)
                        [<span class="constant">:canvas</span> {<span class="constant">:style</span> {<span class="constant">:width</span> 640
                                          <span class="constant">:height</span> 360
                                          <span class="constant">:background-color</span> <span class="string">"#000"</span>}}])
                      [<span class="constant">:pre</span> {<span class="constant">:style</span> {<span class="constant">:width</span> 640
                                     <span class="constant">:border-radius</span> <span class="string">"0px"</span>
                                     <span class="constant">:border</span> <span class="string">"none"</span>}}]]]]]))))
      container)))
</pre>
  </body>
</html>
